<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Disease Bubble Chart</title>

    <style> 
        .header, .footer {
          position: fixed;
          left: 0;
          width: 100%;
          height: 15%;
          background-color: LavenderBlush;
          color: black;
          display: flex;
          align-items: center;
          justify-content: space-between;
          box-sizing: border-box;
        }

        .header {
          top: 0;
          padding: 0 15%;
        }

        .footer {
          bottom: 0;
          padding: 0 2%;
        }

        .body {
          position: relative;
          top: 15%;
          left: 0;
          width: 100%;
          height: 70%;
          padding: 2rem;
          overflow: auto;
        }

        .title {
          position: absolute;
          left: 50%;
          margin: 0;
        }

        .footer_date {
          text-align: right;
        }
    </style>

    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>

    <!-- HEADER -->
    <div class="header">
        <div><a href="index.html">Home</a></div>
        <h1 class="title">Disease Bubble Chart</h1>
        <div><a href="AboutUs.html">About Us</a></div>
    </div>

    <!-- MAIN BODY -->
    <div class="body">
        <h2>Disease Bubble Chart</h2>
        <p>Bigger bubbles represent diseases with more symptoms.</p>

        <div id="bubble-chart" style="width: 100%; height: 800px;"></div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
        <img src="um_logo.png" width="44.92" height="50.28" alt="UM Logo">
        <small class="footer_date">
            <p>created: 2025/10/31</p>
            <p>last updated: 2025/11/14</p>
        </small>
    </div>

    <!-- BUBBLE CHART SCRIPT -->
    <script>
        d3.json("diseases_symptoms.json").then(rows => {

            const grouped = d3.rollup(
                rows,
                v => {
                    const set = new Set(v.map(d => d.symptomLabel));
                    return { count: set.size, symptoms: [...set] };
                },
                d => d.diseaseLabel
            );

            const data = Array.from(grouped, ([diseaseLabel, info]) => ({
                diseaseLabel,
                count: info.count,
                symptoms: info.symptoms
            }));

            data.sort((a,b) => b.count - a.count);

            const width = 1100, height = 900;

            const svg = d3.select("#bubble-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            const root = d3.hierarchy({children: data}).sum(d => d.count);

            const pack = d3.pack()
                .size([width, height])
                .padding(5);

            const nodes = pack(root).leaves();

            const color = d3.scaleSequential()
                .domain(d3.extent(nodes, d => d.data.count))
                .interpolator(d3.interpolatePuRd);

            const tooltip = d3.select("body").append("div")
                .style("position", "absolute")
                .style("background", "white")
                .style("padding", "6px 10px")
                .style("border", "1px solid #ccc")
                .style("border-radius", "4px")
                .style("font-size", "13px")
                .style("opacity", 0)
                .style("pointer-events", "none");

            const node = svg.selectAll("g")
                .data(nodes)
                .enter()
                .append("g")
                .attr("transform", d => `translate(${d.x},${d.y})`);

            node.append("circle")
                .attr("r", d => d.r)
                .attr("fill", d => color(d.data.count))
                .attr("stroke", "#333")
                .on("mouseover", (event,d) => {
                    tooltip.style("opacity", 1)
                        .html(`
                            <strong>${d.data.diseaseLabel}</strong><br>
                            ${d.data.count} symptoms<br><br>
                            <strong>Symptoms:</strong><br>
                            ${d.data.symptoms.join(", ")}
                        `);
                })
                .on("mousemove", (event) => {
                    tooltip.style("left", event.pageX + 10 + "px")
                           .style("top", event.pageY + 10 + "px");
                })
                .on("mouseout", () => tooltip.style("opacity", 0));

            node.append("text")
                .attr("text-anchor", "middle")
                .attr("dy", "0.3em")
                .attr("font-size", d => Math.min(14, d.r / 3))
                .text(d => {
                    const t = d.data.diseaseLabel;
                    return t.length > 15 ? t.slice(0,12) + "â€¦" : t;
                });
        });
    </script>

</body>
</html>


